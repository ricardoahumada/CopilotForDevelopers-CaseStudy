# EJERCICIO SDD: Hiring Time Forecast Model

## Datos del Ejercicio

**Duración:** 90 minutos

**Modalidad:** Parejas  
**Dificultad:** Básica-Intermedia  
**Enfoque:** SDD Híbrido para Proyectos Data/ML con Spec-Kit  

---

## Objetivos de Aprendizaje

- Aplicar metodología Spec-Driven Development (SDD) adaptada para proyectos de machine learning
- Utilizar comandos Spec-Kit para generar artefactos SDD automáticamente
- Definir hipótesis experimentales verificables para modelos de predicción
- Implementar baseline de referencia antes de modelos complejos
- Tomar decisiones basadas en métricas usando gates de decisión
- Documentar proceso experimental con MLflow
- Practicar ciclo completo SDD: Constitución → Spec → Clarify → Plan → Tasks → Implement

---

## Pre-requisitos

Antes de comenzar, asegúrate de tener configurado el entorno de desarrollo:

```bash
# Instalar uv (si no tienes)
curl -LsSf https://astral.sh/uv/install.sh | sh

# Crear entorno virtual
uv venv .venv

# Activar entorno (Windows)
.venv\Scripts\activate

# Instalar dependencias
uv pip install pandas numpy scikit-learn lightgbm mlflow shap jupyter
```

**Dataset local:** `labs3/data/job_offers.csv` (1000 registros disponibles)

---

## Requisitos Adicionales

1. **VS Code con GitHub Copilot Chat habilitado**
2. **uv instalado** (`curl -LsSf https://astral.sh/uv/install.sh | sh`)
3. **Entorno virtual creado:** `uv venv .venv` y activado
4. **Documentación leída:**
   - `base/spec-kit.md`
   - `modules/anexos/a11.sdd-ml.md`
   - `labs3/solution/0.guia.md`

---

**Nota sobre Spec-Kit:** Spec-Kit se ejecuta a través de GitHub Copilot Chat en VS Code. No requiere instalación adicional.

## Comandos Spec-Kit del Ejercicio

| Paso | Comando Spec-Kit | Artefacto Generado | Duración |
|------|------------------|-------------------|----------|
| 2 | `/speckit.constitution` | `.specify/memory/constitution.md` | 15 min |
| 3 | `/speckit.specify` | `specs/001-hiring-time-model/spec.md` | 20 min |
| 3b | `/speckit.clarify` | Preguntas de clarificación | 10 min |
| 4 | `/speckit.plan` | `specs/001-hiring-time-model/plan.md` | 20 min |
| 5 | `/speckit.tasks` | `specs/001-hiring-time-model/tasks.md` | 10 min |
| 6 | `/speckit.implement` | Notebook, módulos Python | 60 min |
| 7 | `/speckit.analyze` | Análisis de coherencia | 10 min |
| 7b | `/speckit.checklist` | Checklist de validación | 5 min |

---

## Flujo General del Ejercicio

```
┌─────────────────────────────────────────────────────────────────────────┐
│                    FLUJO SDD CON SPEC-KIT                               │
├─────────────────────────────────────────────────────────────────────────┤
│                                                                         │
│   Paso 2: /speckit.constitution    →    .specify/memory/constitution.md │
│                   ↓                                                       │
│   Paso 3: /speckit.specify        →    specs/001-hiring-time-model/spec.md
│                   ↓                                                       │
│   Paso 3b: /speckit.clarify       →    Identificar ambigüedades         │
│                   ↓                                                       │
│   Paso 4: /speckit.plan           →    specs/001-hiring-time-model/plan.md
│                   ↓                                                       │
│   Paso 5: /speckit.tasks          →    specs/001-hiring-time-model/tasks.md
│                   ↓                                                       │
│   Paso 6: /speckit.implement      →    src/, experiments/              │
│                   ↓                                                       │
│   /speckit.checklist              →    Validación final                  │
│                                                                         │
└─────────────────────────────────────────────────────────────────────────┘
```

---

## Caso Práctico: Requerimiento Recibido

**De:** Carlos Ruiz - Director de Producto, TalentHub Solutions  
**Asunto:** Nuevo Feature: Predicción de Tiempo de Contratación

> Hola equipo,
>
> Tenemos una solicitud urgente del cliente para implementar un modelo de predicción que estime cuántos días tardará una empresa en cubrir una vacancy específica.
>
> **Problema del cliente:**
> Las empresas publican ofertas sin tener contexto sobre cuánto tiempo tardarán en encontrar el candidato adecuado. Esto afecta la planificación de recursos y la experiencia del candidato.
>
> **Requisito funcional:**
> Como empresa reclutadora, quiero saber cuántos días (estimado) tardaré en encontrar un candidato para esta oferta, para poder planificar mejor mi proceso de contratación.
>
> **Datos disponibles:**
> - Historial de Job Offers del Portal de Empleo (título, descripción, skills, salary, ubicación, tipo contrato)
> - Datos de Applications con timestamps y estados
> - Hiring Outcomes con resultados de procesos completados
> - Dataset local: `labs3/data/job_offers.csv` (1000 registros)
>
> **Restricciones técnicas:**
> - Usar metodología SDD híbrida con Spec-Kit y checkpoints experimentales
> - El modelo debe ser explicable (SHAP values)
> - Mantener reproducibilidad con MLflow
> - Baseline obligatorio antes de modelos complejos
>
> Por favor, documenten el proceso SDD completo y entreguen un baseline funcional.
>
> Saludos,
> **Carlos Ruiz**
> Director de Producto

---

## Contexto del Proyecto

### Proyecto a Crear: Hiring Time Forecast Module

Este ejercicio consiste en crear desde cero el módulo de predicción de tiempo de contratación para TalentForecast Pro. El proyecto no existe aún; lo construirás paso a paso siguiendo la metodología SDD híbrida con Spec-Kit.

### Stack Tecnológico del Ejercicio

| Categoría | Tecnología | Propósito |
|-----------|------------|-----------|
| **Lenguaje** | Python 3.11+ | Desarrollo principal |
| **ML Framework** | LightGBM | Modelo de predicción |
| **Baseline** | LinearRegression | Referencia inicial |
| **Tracking** | MLflow | Experiment tracking |
| **Explainability** | SHAP | Interpretabilidad |
| **Data** | Pandas + NumPy | Manipulación |
| **Notebooks** | Jupyter | Experimentación |
| **SDD Tool** | Spec-Kit | Generación de artefactos |

### Arquitectura de Referencia (objetivo final)

```
hiring-time-forecast/
├── .venv/                          # Entorno virtual uv
├── .specify/
│   └── memory/
│       └── constitution.md
├── specs/
│   └── 001-hiring-time-model/
│       ├── spec.md
│       ├── plan.md
│       └── tasks.md
├── experiments/
│   └── 01_baseline_linear.ipynb
├── mlruns/
├── data/
│   └── raw/
│       └── job_offers.csv          # Dataset local
└── README.md
```

**Nota:** Los módulos en `src/` son opcionales. El usuario decide qué crear según las tareas definidas.

---

## Instrucciones del Ejercicio

### Paso 1: Explorar Contexto y Datos de Referencia

Antes de usar Spec-Kit, necesitas entender los datos disponibles y el contexto del proyecto.

**Tareas:**
1. Revisa el archivo `labs3/01.caso-practico.md` para entender el contexto del proyecto TalentForecast Pro
2. Identifica las entidades principales: JobOffer, Application, HiringOutcome
3. Revisa el dataset local: `labs3/data/job_offers.csv`

**Preguntas a responder:**
- ¿Qué características de una oferta podrían influir en el tiempo de contratación?
- ¿Cuál sería la variable objetivo (target)?
- ¿Qué tipo de features se pueden extraer de los datos disponibles?

---

### Paso 2: Constitución del Proyecto

Crea la constitución del proyecto que define los principios técnicos y estándares para el desarrollo del módulo de ML usando Spec-Kit.

**Entregable:** `.specify/memory/constitution.md`

**Comando Spec-Kit:**
```
/speckit.constitution Genera una constitución para un proyecto de ML de predicción de tiempo de contratación (hiring time forecast). El modelo debe predecir días hasta contratación usando LightGBM como framework principal, MLflow para experiment tracking, y SHAP para explicabilidad. Incluye criterios de baseline obligatorio, gates de decisión basados en métricas (MAE < 5 días), y estándares de reproducibilidad con random_seed=42.
```

**Verificación:**
```bash
ls -la .specify/memory/constitution.md
```

---

### Paso 3: Spec de Hipótesis

Define las hipótesis experimentales usando Spec-Kit. El spec NO debe definir la solución, sino qué quieres lograr y cómo lo medirás.

**Entregable:** `specs/001-hiring-time-model/spec.md`

**Comando Spec-Kit:**
```
/speckit.specify Crea un spec para modelo de predicción de hiring time con estas características:
- Objetivo: Predecir días hasta cubrir una vacancy
- Hipótesis: 1) LightGBM supera baseline lineal por >20% en MAE, 2) salary_normalized es top 3 feature, 3) temporalidad impacta predicción
- Métricas: MAE < 5 días (objetivo), R² > 0.65, Training time < 2 min
- Features: salary_normalized, contract_type, job_level, location_tier, has_remote, month, day_of_week
- Gate 0: MAE baseline < 8 días
- Gate 1: MAE LightGBM < baseline × 0.80
- Dataset: labs3/data/job_offers.csv (1000 registros)
```

**Verificación:**
```bash
ls -la specs/001-hiring-time-model/spec.md
```

---

### Paso 3b: Clarificación

Analiza el spec generado e identifica ambigüedades usando Spec-Kit.

**Comando Spec-Kit:**
```
/speckit.clarify Analiza el spec.md generado para el modelo de hiring time forecast e identifica:
1. Ambigüedades en las hipótesis
2. Features que necesitan más definición
3. Métricas que requieren clarificación
4. Casos edge no cubiertos
```

**Acción:** Revisa las preguntas generadas y refina el spec.md si es necesario.

---

### Paso 4: Plan Experimental

Crea el plan de experimentación con baseline obligatorio y gates de decisión usando Spec-Kit.

**Entregable:** `specs/001-hiring-time-model/plan.md`

**Comando Spec-Kit:**
```
/speckit.plan Genera un plan experimental para hiring time forecast
```

**Posibles fases y gates**:
```
- Fase A: Baseline Linear Regression
- Fase B: LightGBM con todas las features
- Fase C: Optimización con Optuna (condicional)
- Gate 0: MAE baseline < 8 días → continuar a Fase B
- Gate 1: MAE LightGBM < baseline × 0.80 → continuar a Fase C
- Gate 2: MAE < 7 días Y R² > 0.50 → spec final
- Recursos: CPU local, ~90 minutos total
- Dataset: labs3/data/job_offers.csv
```

**Verificación:**
```bash
ls -la specs/001-hiring-time-model/plan.md
```

---

### Paso 5: Desglose de Tareas con Gates

Descompón las tareas de implementación basadas en spec.md y plan.md usando Spec-Kit. Las tareas deben deducirse automáticamente de los artefactos previos.

**Entregable:** `specs/001-hiring-time-model/tasks.md`

**Comando Spec-Kit:**
```
/speckit.tasks Genera tasks.md basado en spec.md y plan.md
```

**Qué debe deducir Spec-Kit:**
- Tareas de cada fase (Baseline, Modelo Principal, Explicabilidad)
- Gates de decisión después de cada fase
- Artefactos de salida
- Dependencias entre tareas

**Verificación:**
```bash
ls -la specs/001-hiring-time-model/tasks.md
```

---

### Paso 6: Implementar Baseline Funcional

Implementa las tareas definidas en tasks.md. Selecciona las tareas prioritarias según los gates de decisión y el tiempo disponible.

**Entregable:** Notebook baseline funcional y módulos Python

**Comando Spec-Kit:**
```
/speckit.implement Implementa las tareas definidas en tasks.md para el hiring time forecast:
- [Elige las tareas prioritarias según los gates definidos].
```

**Qué decide el usuario:**
- Qué tareas implementar primero (recomendado: Baseline → Gate 0 → Modelo Principal)
- Qué módulos generar (src/data/, src/features/, src/models/, experiments/)
- Scope del notebook (mínimo: carga datos + baseline + métricas + Gate 0)

**Estructura mínima del notebook:**
```python
# experiments/01_baseline_linear.ipynb

# 1. Importaciones y Configuración
import pandas as pd
import numpy as np
import mlflow
from sklearn.linear_model import LinearRegression
from sklearn.model_selection import train_test_split
from sklearn.metrics import mean_absolute_error, r2_score

RANDOM_STATE = 42

# 2. Carga de Datos
data = pd.read_csv('../data/raw/job_offers.csv')

# 3. Feature Engineering
X = ...  # Features
y = data['days_to_hire']  # Target

# 4. Split de Datos
X_train, X_test, y_train, y_test = train_test_split(X, y, test_size=0.2, random_state=42)

# 5. Entrenamiento Baseline
model = LinearRegression()
model.fit(X_train, y_train)

# 6. Evaluación
y_pred = model.predict(X_test)
mae = mean_absolute_error(y_test, y_pred)
r2 = r2_score(y_test, y_pred)

# 7. Gate 0
print(f"Baseline MAE: {mae:.2f} días")
print(f"Gate 0: {'PASÓ' if mae < 8 else 'FALLÓ'}")
```

**Verificación:**
```bash
ls -la experiments/01_baseline_linear.ipynb
mlflow ui --port 5000
```

---

### Paso 7: Análisis y Validación

Verifica la coherencia entre todos los artefactos y valida el baseline usando Spec-Kit.

**Comando Spec-Kit:**
```
/speckit.analyze Verifica la coherencia entre:
- constitution.md: principios técnicos definidos
- spec.md: hipótesis y métricas
- plan.md: fases y gates
- tasks.md: tareas por fase
- Código en src/ y experiments/: implementa lo planificado
- Gate 0 verificado: MAE baseline < 8 días
```

**Checklist Final:**
```
/speckit.checklist Genera checklist para validar:
1. Constitution completa con todos los principios ML
2. Spec con 3+ hipótesis verificables
3. Plan con gates de decisión claros
4. Tasks con estimaciones realistas
5. Baseline notebook funcional
6. Métricas MAE, R², RMSE documentadas
7. Gate 0 verificado
8. SHAP values generados (opcional)
9. MLflow experiments registrados
```

---

## Entregables del Ejercicio

Al finalizar el ejercicio, deben tener los siguientes archivos:

| Archivo | Descripción | Estado |
|---------|-------------|--------|
| `.specify/memory/constitution.md` | Principios técnicos y estándares ML | ☐ |
| `specs/001-hiring-time-model/spec.md` | Hipótesis experimentales y métricas | ☐ |
| `specs/001-hiring-time-model/plan.md` | Plan de experimentación con gates | ☐ |
| `specs/001-hiring-time-model/tasks.md` | Tareas descompuestas con gates | ☐ |
| `experiments/01_baseline_linear.ipynb` | Notebook baseline funcional | ☐ |
| `mlruns/` | Directorio de tracking MLflow | ☐ |

---

## Preguntas de Clarificación

Antes de comenzar, identifica 2-3 ambigüedades del requerimiento. Usa `/speckit.clarify` para ayudarte:

1. **Definición de días hasta contratación:**
   - Pregunta: ¿Se cuenta desde la publicación de la oferta hasta la aceptación del candidato?
   - Impacto: Afecta el cálculo de la variable objetivo `days_to_hire`

2. **Features de texto:**
   - Pregunta: ¿Cómo manejar el título y descripción de la oferta?
   - Impacto: Requiere NLP o embedding vs. keywords simples

3. **Periodo de datos:**
   - Pregunta: ¿Los datos históricos abarcan cuántos meses?
   - Impacto: Afecta la estacionalidad del modelo

---

## Rúbrica de Evaluación

| Criterio | Peso |Excelente (100%) | Bueno (75%) | Suficiente (50%) | Insuficiente (25%) |
|----------|------|-----------------|-------------|------------------|--------------------|
| **Constitution** | 15% | Completa con todos los principios ML bien definidos | Completa con mayoría de elementos | Parcialmente completa | Incompleta o incorrecta |
| **Spec de Hipótesis** | 20% | 3+ hipótesis claras y verificables con métricas realistas | 2 hipótesis claras | 1 hipótesis básica | Sin hipótesis claras |
| **Plan Experimental** | 15% | Gates de decisión claros y métricas de comparación | Gates definidos | Plan parcial | Sin plan o gates |
| **Tasks** | 10% | Tareas completas con gates apropiados | Tareas bien definidas | Tareas parciales | Tareas incompletas |
| **Baseline Notebook** | 25% | Funcional con MLflow, métricas, SHAP y código limpio | Funcional con errores menores | Parcialmente funcional | No funcional |
| **Spec-Kit Usage** | 15% | Usa todos los comandos correctamente | Usa mayoría de comandos | Usa pocos comandos | No usa Spec-Kit |

**Criterios de aprobación:** Mínimo 70% total y baseline notebook funcional con Gate 0 aprobado.

---

## Notas para Instructores

### Puntos Críticos donde los Alumnos pueden Fallar

1. **Copilot Chat no habilitado:** Verificar que GitHub Copilot Chat esté activo en VS Code
2. **Gates mal definidos:** Los gates deben estar basados en métricas, no en opinión
3. **MLflow no configurado:** Verificar que el tracking URI esté configurado correctamente
4. **Dataset no encontrado:** Verificar path `labs3/data/job_offers.csv`
5. **Entorno virtual no activado:** Asegurar que `.venv` esté activado

### Preguntas Frecuentes Esperadas

- **¿Podemos usar otro framework en lugar de LightGBM?** Sí, pero debe justificarse en la constitución
- **¿Qué pasa si el baseline no cumple el gate?** Se debe documentar y revisar features/target, no continuar
- **¿Cuántos datos necesitamos?** Dataset local tiene 1000 registros
- **¿Spec-Kit es obligatorio?** Sí, es parte del enfoque del ejercicio

### Adaptaciones

- Si el grupo tiene más experiencia: Añadir Fase C de optimización con Optuna
- Si el grupo tiene menos experiencia: Reducir alcance del notebook baseline
- Si hay problemas técnicos: Usar prompts genéricos como fallback

---

## Recursos de Apoyo

### Documentación de Referencia

| Recurso | Enlace |
|---------|--------|
| Documentación Spec-Kit | `base/spec-kit.md` |
| Guía Spec-Kit para Ejercicio | `labs3/solution/0.guia.md` |
| SDD para ML | `modules/anexos/a11.sdd-ml.md` |
| Documentación LightGBM | https://lightgbm.readthedocs.io/ |
| Documentación MLflow | https://mlflow.org/docs/latest/ |
| Documentación SHAP | https://shap.readthedocs.io/ |
| Scikit-learn Metrics | https://scikit-learn.org/stable/modules/model_evaluation.html |

---

*Ejercicio práctico desarrollado para el curso de Microsoft Copilot en el Entorno de Desarrollo Local, módulo de Spec-Driven Development para Proyectos Data/ML con Spec-Kit.*
