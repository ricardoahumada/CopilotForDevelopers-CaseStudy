# EJERCICICIO SDD: Hiring Time Forecast Model

## Datos del Ejercicio

**Duración:** 1.5 horas (90 minutos)  
**Modalidad:** Parejas  
**Dificultad:** Básica-Intermedia  
**Enfoque:** SDD Híbrido para Proyectos Data/ML

---

## Objetivos de Aprendizaje

- Aplicar metodología Spec-Driven Development (SDD) adaptada para proyectos de machine learning
- Definir hipótesis experimentales verificables para modelos de predicción
- Implementar baseline de referencia antes de modelos complejos
- Tomar decisiones basadas en métricas usando gates de decisión
- Documentar proceso experimental con MLflow
- Practicar ciclo completo SDD: Constitución → Spec → Plan → Tasks → Baseline

---

## Preparación Previa

Antes de comenzar, asegúrate de tener configurado el entorno de desarrollo:

```bash
# Verificar versión de Python
python --version  # Debe ser 3.11 o superior

# Instalar dependencias básicas
pip install pandas numpy scikit-learn lightgbm mlflow shap

# Verificar instalación de Jupyter
pip install jupyter
```

Para este ejercicio consumirás datos del **Portal de Empleo API** desarrollado en el caso práctico principal. Asegúrate de tener acceso al endpoint de Job Offers o utiliza el dataset de muestra proporcionado.

---

## Caso Práctico: Requerimiento Recibido

**De:** Carlos Ruiz - Director de Producto, TalentHub Solutions  
**Asunto:** Nuevo Feature: Predicción de Tiempo de Contratación

> Hola equipo,
>
> Tenemos una solicitud urgente del cliente para implementar un modelo de predicción que estime cuántos días tardará una empresa en cubrir una vacancy específica.
>
> **Problema del cliente:**
> Las empresas publican ofertas sin tener contexto sobre cuánto tiempo tardarán en encontrar el candidato adecuado. Esto afecta la planificación de recursos y la experiencia del candidato.
>
> **Requisito funcional:**
> Como empresa reclutadora, quiero saber cuántos días预计 (estimado) tardaré en encontrar un candidato para esta oferta, para poder planificar mejor mi proceso de contratación.
>
> **Datos disponibles:**
> - Historial de Job Offers del Portal de Empleo (título, descripción, skills, salary, ubicación, tipo contrato)
> - Datos de Applications con timestamps y estados
> - Hiring Outcomes con resultados de procesos completados
>
> **Restricciones técnicas:**
> - Usar metodología SDD híbrida con checkpoints experimentales
> - El modelo debe ser explicable (SHAP values)
> - Mantener reproducibilidad con MLflow
> - Baseline obligatorio antes de modelos complejos
>
> Por favor, documenten el proceso SDD completo y entreguen un baseline funcional en 1.5 horas.
>
> Saludos,
> **Carlos Ruiz**
> Director de Producto

---

## Contexto del Proyecto

### Proyecto a Crear: Hiring Time Forecast Module

Este ejercicio consiste en crear desde cero el módulo de predicción de tiempo de contratación para TalentForecast Pro. El proyecto no existe aún; lo construirás paso a paso siguiendo la metodología SDD híbrida.

### Stack Tecnológico del Ejercicio

| Categoría | Tecnología | Propósito |
|-----------|------------|-----------|
| **Lenguaje** | Python 3.11+ | Desarrollo principal |
| **ML Framework** | LightGBM | Modelo de predicción |
| **Baseline** | LinearRegression | Referencia inicial |
| **Tracking** | MLflow | Experiment tracking |
| **Explainability** | SHAP | Interpretabilidad |
| **Data** | Pandas + NumPy | Manipulación |
| **Notebooks** | Jupyter | Experimentación |

### Arquitectura de Referencia (objetivo final)

```
hiring-time-forecast/
├── .specify/
│   └── memory/
│       └── constitution.md
├── specs/
│   └── 001-hiring-time-model/
│       ├── spec.md
│       ├── plan.md
│       └── tasks.md
├── experiments/
│   └── 01_baseline_linear.ipynb
├── mlruns/
├── src/
│   ├── data/
│   │   └── load_data.py
│   ├── features/
│   │   └── engineer_features.py
│   ├── models/
│   │   └── baseline_linear.py
│   └── evaluation/
│       └── evaluate.py
├── data/
│   └── raw/
├── requirements.txt
└── README.md
```

---

## Instrucciones del Ejercicio

### Paso 1: Explorar Contexto y Datos de Referencia (10 min)

Antes de spec, necesitas entender los datos disponibles. Revisa la documentación del Portal de Empleo para entender la estructura de Job Offers y Applications.

**Tareas:**
1. Revisa el archivo `labs3/01.caso-practico.md` para entender el contexto del proyecto TalentForecast Pro
2. Identifica las entidades principales: JobOffer, Application, HiringOutcome
3. Define qué features podrían ser útiles para predecir tiempo de contratación

**Preguntas a responder:**
- ¿Qué características de una oferta podrían influir en el tiempo de contratación?
- ¿Cuál sería la variable objetivo (target)?
- ¿Qué tipo de features se pueden extraer de los datos disponibles?

---

### Paso 2: Constitución del Proyecto (15 min)

Crea la constitución del proyecto que define los principios técnicos y estándares para el desarrollo del módulo de ML.

**Entregable:** `.specify/memory/constitution.md`

**Plantilla a completar:**

```markdown
# .specify/memory/constitution.md

## Principios Técnicos
- Python 3.11+ como lenguaje principal
- [COMPLETAR] Framework para modelo de predicción
- [COMPLETAR] Herramienta para tracking de experimentos
- [COMPLETAR] Biblioteca para explicabilidad de modelos

## Estándares de Datos
- Validación de calidad con [COMPLETAR]
- Feature store con versionado temporal
- Lineage de datos desde [COMPLETAR]

## Requisitos de Modelado
- Documentación de hipótesis antes de cada experimento
- [COMPLETAR] obligatorio antes de modelos complejos
- SHAP values para explicabilidad
- Reentrenamiento cuando drift > [COMPLETAR]%

## Proceso Experimental
- Tesis experimental antes de cada fase
- Gates de decisión entre fases
- Solo se hace "spec final" cuando modelo cumple criterios
```

**Usa Copilot para:**
- Completar los frameworks tecnológicos faltantes
- Definir métricas de éxito apropiadas
- Establecer gates de decisión basados en métricas

**Prompt sugerido para Copilot:**
```
Ayúdame a completar la constitución para un proyecto de ML de predicción de tiempo de contratación.
El objetivo es predecir days_to_hire con MAE < 5 días.
Necesito quedefinas:
1. Framework de ML ( LightGBM, XGBoost, o CatBoost)
2. Herramienta de tracking (MLflow o Weights & Biases)
3. Criterios de baseline obligatorio
4. Gates de decisión basados en métricas
```

---

### Paso 3: Spec de Hipótesis (20 min)

Define las hipótesis experimentales que vas a validar. El spec NO debe definir la solución, sino qué quieres lograr y cómo lo medirás.

**Entregable:** `specs/001-hiring-time-model/spec.md`

**Plantilla a completar:**

```markdown
# specs/001-hiring-time-model/spec.md

## Objetivo Experimental
[COMPLETAR: Qué problema resuelve este modelo]

## Hipótesis a Validar

### Hipótesis Principal
H0: [COMPLETAR: Hipótesis nula sobre el rendimiento baseline]

### Hipótesis Alternativas
H1: [COMPLETAR: El modelo superará al baseline por más del X%]
- Justificación: [COMPLETAR]
- Tipo: [COMPLETAR: Direccional/No direccional]

H2: [COMPLETAR: Feature más importante]
- Justificación: [COMPLETAR]
- Tipo: [COMPLETAR]

H3: [COMPLETAR: Otra hipótesis]
- Justificación: [COMPLETAR]

## Métricas de Éxito

| Métrica | Objetivo | Mínimo Aceptable |
|---------|----------|------------------|
| MAE | [COMPLETAR] | [COMPLETAR] |
| R² | [COMPLETAR] | [COMPLETAR] |
| Training Time | [COMPLETAR] | [COMPLETAR] |
| Inference Time | [COMPLETAR] | [COMPLETAR] |

## Criterios de Éxito Experimental
- [ ] MAE en test set < [COMPLETAR] días
- [ ] R² > [COMPLETAR] en validación
- [ ] Top 3 features interpretables (SHAP)
- [ ] Latencia predicción < [COMPLETAR]ms
- [ ] Reproducibilidad con random seed

## Datos de Entrada
- Fuente: [COMPLETAR: Portal API o dataset]
- Período: [COMPLETAR]
- Tamaño estimado: [COMPLETAR] registros

## Features Potenciales
| Feature | Tipo | Descripción |
|---------|------|-------------|
| [COMPLETAR] | [COMPLETAR] | [COMPLETAR] |
| [COMPLETAR] | [COMPLETAR] | [COMPLETAR] |
```

**Usa Copilot para:**
- Completar las hipótesis basadas en el dominio de recursos humanos
- Definir métricas realistas para el problema
- Identificar features potenciales de las entidades del Portal

**Prompt sugerido para Copilot:**
```
Para un modelo de predicción de tiempo de contratación en un portal de empleo,
ayúdame a definir:
1. 3 hipótesis experimentales específicas (por qué ciertas features afectan el tiempo de contratación)
2. Métricas realistas de MAE y R² para este tipo de problema
3. 5 features específicas que se pueden extraer de JobOffers (título, salary, tipo contrato, etc.)
```

---

### Paso 4: Plan Experimental (20 min)

Crea el plan de experimentación con baseline obligatorio y gates de decisión.

**Entregable:** `specs/001-hiring-time-model/plan.md`

**Plantilla a completar:**

```markdown
# specs/001-hiring-time-model/plan.md

## Fases de Experimentación

### Fase A: Baseline (Referencia)
[COMPLETAR: Descripción del experimento baseline]

**Experimento A1: Regresión Lineal**
- Features: [COMPLETAR]
- Objetivo: Establecer baseline de MAE
- Recursos: [COMPLETAR]

### Fase B: Modelo Principal
[COMPLETAR: Descripción del modelo a entrenar]

**Experimento B1: [COMPLETAR: LightGBM/Random Forest]**
- Features: [COMPLETAR]
- Hipótesis: [COMPLETAR]
- Recursos: [COMPLETAR]

## Gates de Decisión

| Gate | Condición | Acción si Pasa | Acción si No Pasa |
|------|-----------|----------------|-------------------|
| Gate 0 | ¿Baseline MAE < [COMPLETAR]? | Continuar a Fase B | Revisar features/target |
| Gate 1 | ¿Modelo supera baseline > [COMPLETAR]%? | Continuar a optimización | Revisar arquitectura |
| Gate 2 | ¿MAE < [COMPLETAR] y R² > [COMPLETAR]? | Spec Final | Iterar en features |

## Métricas de Comparación

| Experimento | MAE | R² | Train Time | Inference Time |
|-------------|-----|-----|------------|----------------|
| Baseline Linear | ? | ? | ? | ? |
| [COMPLETAR] | ? | ? | ? | ? |

## Recursos Necesarios
- Compute: [COMPLETAR: Local/Cloud]
- Almacenamiento: [COMPLETAR: GB]
- Tiempo estimado: [COMPLETAR]
```

**Usa Copilot para:**
- Definir gates de decisión basados en métricas realistas
- Crear plan de experimentación estructurado
- Estimar recursos necesarios

**Prompt sugerido para Copilot:**
```
Para un modelo de hiring time forecast, ayúdame a crear un plan experimental con:
1. Un gate de decisión después del baseline (ej: si MAE baseline < 8 días, continuar)
2. Gate después del modelo principal (ej: si MAE < 5 días, pasar a spec final)
3. Métricas de comparación entre baseline y modelo
4. Recomendaciones de recursos computacionales
```

---

### Paso 5: Desglose de Tareas con Gates (15 min)

Descompón las tareas de implementación y asigna gates de decisión.

**Entregable:** `specs/001-hiring-time-model/tasks.md`

**Plantilla a completar:**

```markdown
# specs/001-hiring-time-model/tasks.md

## Fase A: Baseline
- [ ] T001: [COMPLETAR: Implementar carga de datos desde Portal API]
- [ ] T002: [COMPLETAR: Implementar feature engineering básico]
- [ ] T003: [COMPLETAR: Entrenar modelo baseline (Linear Regression)]
- [ ] T004: [COMPLETAR: Medir métricas baseline y documentar]
  - → GATE 0: ¿MAE baseline < [COMPLETAR] días?

## Fase B: Modelo Principal
- [ ] T010: [COMPLETAR: Implementar modelo con framework seleccionado]
- [ ] T011: [COMPLETAR: Entrenar modelo con early stopping]
- [ ] T012: [COMPLETAR: Evaluar en test set]
- [ ] T013: [COMPLETAR: Comparar con baseline]
  - → GATE 1: ¿Modelo supera baseline > [COMPLETAR]%?

## Fase C: Explicabilidad (opcional si gates pasan)
- [ ] T020: [COMPLETAR: Generar SHAP values]
- [ ] T021: [COMPLETAR: Identificar top features]
- [ ] T022: [COMPLETAR: Documentar interpretabilidad]
  - → GATE 2: ¿MAE < [COMPLETAR] y R² > [COMPLETAR]?

## Artefactos de Salida
- [ ] Modelo entrenado: [COMPLETAR: path]
- [ ] Métricas documentadas: [COMPLETAR: path]
- [ ] Notebook baseline: [COMPLETAR: path]
- [ ] Spec Final (si gates pasan): [COMPLETAR: final-model-spec.md]
```

**Usa Copilot para:**
- Completar tareas específicas de ML pipeline
- Asignar gates de decisión apropiados
- Definir artefactos de salida claros

**Prompt sugerido para Copilot:**
```
Para un pipeline de ML de hiring time forecast, ayúdame a:
1. Listar tareas específicas para fase de baseline (carga datos, features, entrenamiento, evaluación)
2. Definir tareas para fase de modelo principal
3. Asignar gates de decisión realistas entre fases
4. Especificar artefactos de salida de cada fase
```

---

### Paso 6: Implementar Baseline Funcional (30 min)

Implementa el baseline de regresión lineal en un Jupyter notebook funcional que consuma datos del Portal API y entrene el modelo.

**Entregable:** `experiments/01_baseline_linear.ipynb`

**Estructura del Notebook:**

```python
# experiments/01_baseline_linear.ipynb

# 1. Importaciones y Configuración
import pandas as pd
import numpy as np
import mlflow
import mlflow.sklearn
from sklearn.linear_model import LinearRegression
from sklearn.model_selection import train_test_split
from sklearn.metrics import mean_absolute_error, r2_score, mean_squared_error
import shap
import matplotlib.pyplot as plt

# Configuración
RANDOM_STATE = 42
np.random.seed(RANDOM_STATE)

# 2. Carga de Datos
# [COMPLETAR: Cargar datos desde Portal API o dataset local]
# data = pd.read_csv('../data/raw/job_offers.csv')

# 3. Feature Engineering
# [COMPLETAR: Transformar datos crudos en features]
# X = ...  # Features
# y = ...  # Target: days_to_hire

# 4. Split de Datos
# [COMPLETAR: train_test_split con stratificación si aplica]
# X_train, X_test, y_train, y_test = ...

# 5. Entrenamiento Baseline
# [COMPLETAR: Linear Regression]
# model = LinearRegression()
# model.fit(X_train, y_train)

# 6. Evaluación
# [COMPLETAR: Calcular MAE, R², RMSE]
# y_pred = model.predict(X_test)
# mae = mean_absolute_error(y_test, y_pred)
# r2 = r2_score(y_test, y_pred)

# 7. Logging con MLflow
# [COMPLETAR: mlflow.log_metrics, mlflow.sklearn.log_model]

# 8. SHAP Analysis (opcional para baseline)
# [COMPLETAR: Explainability]

# 9. Resultados
print(f"Baseline Linear Regression Results:")
print(f"MAE: {mae:.2f} días")
print(f"R²: {r2:.3f}")
print(f"RMSE: {np.sqrt(mean_squared_error(y_test, y_pred)):.2f} días")
```

**Usa Copilot para:**
- Completar código de carga de datos desde Portal API
- Implementar feature engineering básico
- Configurar MLflow logging
- Generar visualizaciones de resultados

**Prompt sugerido para Copilot (para usar en Copilot Chat):**
```
Ayúdame a escribir el código para un notebook de baseline de hiring time forecast:
1. Código para cargar datos desde una API REST de Job Offers (httpx)
2. Feature engineering: convertir título a embeddings TF-IDF, codificar tipo contrato, normalizar salary
3. Calcular variable objetivo days_to_hire desde Application timestamps
4. Configurar MLflow para tracking local
5. Calcular métricas MAE, R², RMSE y mostrarlas
```

---

## Entregables del Ejercicio

Al finalizar el ejercicio, deben tener los siguientes archivos:

| Archivo | Descripción | Estado |
|---------|-------------|--------|
| `.specify/memory/constitution.md` | Principios técnicos y estándares ML | ☐ |
| `specs/001-hiring-time-model/spec.md` | Hipótesis experimentales y métricas | ☐ |
| `specs/001-hiring-time-model/plan.md` | Plan de experimentación con gates | ☐ |
| `specs/001-hiring-time-model/tasks.md` | Tareas descompuestas con gates | ☐ |
| `experiments/01_baseline_linear.ipynb` | Notebook baseline funcional | ☐ |
| `mlruns/` | Directorio de tracking MLflow | ☐ |

---

## Preguntas de Clarificación

Antes de comenzar, identifica 2-3 ambigüedades del requerimiento y propón preguntas para Carlos Ruiz:

1. **[COMPLETAR]:**
   - Pregunta: [COMPLETAR]
   - Impacto: [COMPLETAR]

2. **[COMPLETAR]:**
   - Pregunta: [COMPLETAR]
   - Impacto: [COMPLETAR]

3. **[COMPLETAR]:**
   - Pregunta: [COMPLETAR]
   - Impacto: [COMPLETAR]

---

## Rúbrica de Evaluación

| Criterio | Peso |Excelente (100%) | Bueno (75%) | Suficiente (50%) | Insuficiente (25%) |
|----------|------|-----------------|-------------|------------------|--------------------|
| **Constitution** | 15% | Completa con todos los principios ML bien definidos | Completa con mayoría de elementos | Parcialmente completa | Incompleta o incorrecta |
| **Spec de Hipótesis** | 25% | 3+ hipótesis claras y verificables con métricas realistas | 2 hipótesis claras | 1 hipótesis básica | Sin hipótesis claras |
| **Plan Experimental** | 20% | Gates de decisión claros y métricas de comparación | Gates definidos | Plan parcial | Sin plan o gates |
| **Tasks** | 15% | Tareas completas con gates apropiados | Tareas bien definidas | Tareas parciales | Tareas incompletas |
| **Baseline Notebook** | 25% | Funcional con MLflow, métricas y código limpio | Funcional con errores menores | Parcialmente funcional | No funcional |

**Criterios de aprobación:** Mínimo 70%总分 y baseline notebook funcional.

---

## Notas para Instructores

### Puntos Críticos donde los Alumnos pueden Fallar

1. **Definir hipótesis vagas:** Asegurar que las hipótesis sean verificables y tengan métricas asociadas
2. **Olvidar el baseline:** Algunos alumnos pueden querer saltar directamente al modelo complejo
3. **Gates mal definidos:** Los gates deben estar basados en métricas, no en opinión
4. **MLflow no configurado:** Verificar que el tracking URI esté configurado correctamente

### Preguntas Frecuentes Esperadas

- **¿Podemos usar otro framework en lugar de LightGBM?** Sí, pero debe justificarse en la constitución
- **¿Qué pasa si el baseline no cumple el gate?** Se debe documentar y revisar features/target, no continuar
- **¿Cuántos datos necesitamos?** Mínimo 100 registros históricos con outcomes completados

### Adaptaciones

- Si el grupo tiene más experiencia: Añadir Fase C de optimización con Optuna
- Si el grupo tiene menos experiencia: Proporcionar notebook parcialmente completado

---

## Recursos de Apoyo

### Documentación de Referencia

| Recurso | Enlace |
|---------|--------|
| Documentación LightGBM | https://lightgbm.readthedocs.io/ |
| Documentación MLflow | https://mlflow.org/docs/latest/ |
| Documentación SHAP | https://shap.readthedocs.io/ |
| Scikit-learn Metrics | https://scikit-learn.org/stable/modules/model_evaluation.html |

### Plantillas Copilot

**Prompt para Constitution:**
```
Ayúdame a crear una constitución para proyecto ML con:
- Framework: LightGBM
- Tracking: MLflow  
- Explicabilidad: SHAP
- Criterios de baseline y gates de decisión
```

**Prompt para Spec:**
```
Para predicción de hiring time (días hasta contratación):
- Hipótesis sobre features más importantes
- Métricas MAE objetivo (< 5 días)
- Features de Job Offer: título, salary, tipo contrato, ubicación
```

**Prompt para Notebook:**
```
Código Python para:
1. Cargar datos desde API REST (httpx)
2. Feature engineering con Pandas
3. Linear Regression baseline con scikit-learn
4. MLflow tracking local
5. Calcular MAE, R², RMSE
```

---

*Ejercicio práctico desarrollado para el curso de Microsoft Copilot en el Entorno de Desarrollo Local, módulo de Spec-Driven Development para Proyectos Data/ML.*
