# Gestión de Librerías NuGet en Proyectos Spec-Kit SDD

## Resumen Rápido

| Necesidad | Documentar en | Cuándo |
|-----------|---------------|--------|
| Libs corporativas obligatorias | `constitution.md` | Sprint Planning |
| Libs específicas del feature | `plan.md` | Planificación Técnica |
| Configuración feeds | `nuget.config` | Inicio del proyecto |
| Referencias en proyectos | `.csproj` | Implementación |

---

## 1. Dónde Documentar Cada Tipo de Dependencia

### 1.1 Constitution.md → Librerías Corporativas Estándar

**Qué:** Libs transversales obligatorias para todos los proyectos.

```markdown
## Technology Standards

### Authentication
- **MiOrg.Auth** v3.0 - SSO corporativo
- **Microsoft.AspNetCore.Authentication.JwtBearer** v8.0

### Data Access
- **MiOrg.EF.Extensions** v4.0 - Audit y soft delete
- **Npgsql.EntityFrameworkCore.PostgreSQL** v8.0

### Validation & Errors
- **FluentValidation** v11.9
- **MiOrg.Exceptions** v1.5

### Testing
- **xUnit**, **Moq**, **FluentAssertions**
```

**Cuándo usarlo:** libs que todos los proyectos deben usar por estándar organizacional.

---

### 1.2 Plan.md → Librerías del Feature

**Qué:** libs específicas para un feature o módulo.

```markdown
## Technology Stack Decisions

### NuGet Dependencies

| Package | Version | Purpose | Justification |
|---------|---------|---------|---------------|
| FluentValidation.AspNetCore | 11.3.0 | Validación DTOs | En constitución |
| AutoMapper | 13.0 | Mapping DTO-Entity | Reduce boilerplate |
| MediatR | 12.2 | CQRS | Separa commands/queries |

### Package Source
Feed corporativo: https://pkgs.dev.azure.com/MiOrg/.../nuget/v3/index.json
```

**Cuándo usarlo:** durante planificación técnica de cada feature.

---

### 1.3 Nuget.config → Configuración de Fuentes

**Ubicación:** raíz de la solución o `src/`

```xml
<?xml version="1.0" encoding="utf-8"?>
<configuration>
  <packageSources>
    <clear />
    <add key="nuget.org" value="https://api.nuget.org/v3/index.json" />
    <add key="MiOrganizacion" value="https://pkgs.dev.azure.com/.../index.json" />
  </packageSources>
  
  <packageSourceMapping>
    <packageSource key="MiOrganizacion">
      <package pattern="MiOrganizacion.*" />
      <package pattern="FluentValidation*" />
      <package pattern="AutoMapper" />
    </packageSource>
  </packageSourceMapping>
</configuration>
```

---

## 2. Flujo Scrum-SpecKit para NuGets

```
┌─────────────────┬──────────────────────┬──────────────────────────┐
│ Fase Scrum      │ Qué hacer con NuGet  │ Artefacto SDD            │
├─────────────────┼──────────────────────┼──────────────────────────┤
│ Sprint Planning │ Identificar needs    │ Revisar constitution     │
│ Especificación  │ Definir capacidades  │ spec.md (no libs)        │
│ Plan Técnica    │ SELECCIONAR libs     │ plan.md ← CLAVE          │
│ Implementación  │ Instalar referencias │ .csproj (AI Agent)       │
│ Revisión        │ Demostrar libs usadas │ -                        │
│ Retrospectiva   │ Evaluar proceso      │ Lessons learned          │
└─────────────────┴──────────────────────┴──────────────────────────┘
```

---

## 3. Regla de Oro

| Si la librería es... | Documentar en | Ejemplo |
|----------------------|---------------|---------|
| Estándar organizacional | `constitution.md` | `MiOrg.Auth` |
| Específica del feature | `plan.md` | `AutoMapper` para un módulo |
| Feed privado corporativo | `nuget.config` | Azure Artifacts |

---

## 4. Mejores Prácticas

| Práctica | Acción |
|----------|--------|
| **Revisión mensual** | Ver actualizaciones y vulnerabilidades |
| **Documentar justificación** | Por qué se eligió cada librería |
| **Credenciales seguras** | Nunca en nuget.config versionado |

---

**Referencias:**
- [Spec-Kit SDD Workflow](../base/spec-kit.md)
- [AGENTS.md Configuration](a1.agents-md.md)
- [Constitution Guidelines](a4.constitution.md)
