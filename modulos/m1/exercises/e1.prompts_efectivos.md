# Ejercicio: Generar Prompts Efectivos con Enfoque SDD (Vibe Coding)

**Módulo:** 1 - Ingeniería de Prompts y Personalización  
**Duración:** 45 minutos  
**Modalidad:** Práctica individual

---

## Objetivo

Practicar la redacción de prompts efectivos siguiendo los principios de Spec-Driven Development (SDD), sin necesidad de AGENTS.md ni spec-kit instalado. El objetivo es dominar el arte de especificar claramente lo que necesitamos a la IA.

---

## Contexto del Caso Práctico

Estás trabajando en el **Portal de Empleo API** de TalentHub Solutions. Debes generar prompts efectivos para que GitHub Copilot genere código de calidad siguiendo Clean Architecture y principios SOLID.

---

## Ejercicio 1: Entidad de Dominio "User"

### Prompt Base (a mejorar)
```markdown
"Create a User entity in C# for a job portal API"
```

### Criterios del Buen Prompt

Un prompt efectivo para esta entidad debe incluir:

1. **Contexto del dominio:** Mencionar que es parte de un sistema de empleo
2. **Definición de propiedades:** Listar todas las propiedades con tipos de datos
3. **Restricciones de dominio:** Longitudes máximas, formatos requeridos
4. **Enumeraciones necesarias:** Incluir UserRole con sus valores
5. **Documentación:** Indicar uso de XML documentation comments
6. **Formato de salida:** Especificar estructura del código

### Propiedad Guid
```
- Id: Guid (identificador único)
```

### Propiedad string (con validaciones)
```
- Email: string (formato válido único, máximo 256 caracteres)
- Password: string (will be hashed with BCrypt, no plaintext storage)
- Name: string (máximo 100 caracteres)
- Phone: string (formato internacional)
```

### Propiedad DateTime
```
- BirthDate: DateTime (validar mayoría de edad)
```

### Propiedad de Colección
```
- Skills: List<string> (habilidades del candidato)
```

### Propiedad Enum
```
- Role: UserRole (CANDIDATE, COMPANY, ADMIN)
```

### Propiedad bool
```
- IsActive: bool (para soft delete)
```

### Enumeración UserRole
```csharp
public enum UserRole
{
    CANDIDATE = 0,
    COMPANY = 1,
    ADMIN = 2
}
```

### Ejemplo de Prompt Mejorado
```markdown
"Create a User entity for a Job Portal API following Clean Architecture principles.
The entity should have:
- Id: Guid (primary key)
- Email: string (unique, max 256 chars, valid email format)
- Password: string (will be hashed with BCrypt, never store plaintext)
- Name: string (max 100 chars, required)
- BirthDate: DateTime (must be at least 16 years old)
- Phone: string (optional, international format)
- Skills: List<string> (optional, candidate skills)
- Role: UserRole enum (CANDIDATE, COMPANY, ADMIN)
- IsActive: bool (default true, for soft delete)
- CreatedAt: DateTime
- UpdatedAt: DateTime

Include XML documentation for all public members.
Return only the C# code for the entity class."
```

---

## Ejercicio 2: Servicio de Autenticación

### Prompt Base (a mejorar)
```markdown
"Write an AuthService class for login and register"
```

### Criterios del Buen Prompt

Un prompt efectivo para el servicio de autenticación debe incluir:

1. **Definición de métodos:** Especificar cada método con su propósito
2. **DTOs de entrada/salida:** Nombrar los objetos de transferencia de datos
3. **Dependencias externas:** Indicar uso de JWT, BCrypt, repositories
4. **Configuración JWT:** Especificar claims, tiempos de expiración
5. **Comportamiento esperado:** Qué hace cada método, qué devuelve, qué lanza
6. **Validaciones:** Reglas de negocio a aplicar

### Métodos Requeridos
```
- RegisterAsync: Crea nuevo usuario, hashea contraseña, retorna tokens
- LoginAsync: Valida credenciales, genera tokens JWT
- RefreshTokenAsync: Renueva access token con refresh token válido
- RevokeTokenAsync: Invalida refresh token (logout)
```

### DTOs de Entrada
```csharp
public class LoginDto
{
    public string Email { get; set; }
    public string Password { get; set; }
}

public class RegisterDto
{
    public string Email { get; set; }
    public string Password { get; set; }
    public string Name { get; set; }
    public DateTime BirthDate { get; set; }
    public string Phone { get; set; }
}

public class RefreshTokenDto
{
    public string RefreshToken { get; set; }
}
```

### DTOs de Salida
```csharp
public class AuthResultDto
{
    public string AccessToken { get; set; }
    public string RefreshToken { get; set; }
    public DateTime AccessTokenExpiresAt { get; set; }
    public DateTime RefreshTokenExpiresAt { get; set; }
    public UserDto User { get; set; }
}
```

### Configuración JWT Requerida
```
- Algorithm: HS256
- Access Token Expiry: 60 minutes
- Refresh Token Expiry: 7 days
- Required Claims: sub (userId), email, role, exp
- Secret Key: Minimum 32 characters
```

### Excepciones a Manejar
```
- InvalidCredentialsException (wrong email/password)
- UserNotFoundException
- UserInactiveException
- InvalidRefreshTokenException
- PasswordMismatchException
```

### Ejemplo de Prompt Mejorado
```markdown
"Create an AuthService class for a Job Portal API that implements:

Methods:
1. RegisterAsync(RegisterDto dto) -> AuthResultDto
   - Validates email doesn't exist, hash password with BCrypt (work factor 12)
   - Creates user with CANDIDATE role by default, returns JWT tokens

2. LoginAsync(LoginDto dto) -> AuthResultDto
   - Finds user by email, validates password with BCrypt
   - Checks user IsActive flag
   - Generates access token (60min) and refresh token (7 days)
   - Returns AuthResultDto with tokens and user info

3. RefreshTokenAsync(RefreshTokenDto dto) -> AuthResultDto
   - Validates refresh token is not expired and exists
   - Generates new access token, keeps same refresh token

Use JWT with HS256, claims: sub, email, role, exp.
Inject IUserRepository and IConfiguration.
Throw custom exceptions with meaningful messages.
Include XML documentation for all public methods."
```

---

## Ejercicio 3: Controlador REST de Ofertas

### Prompt Base (a mejorar)
```markdown
"Create a JobOffersController with GET POST PUT PATCH endpoints"
```

### Criterios del Buen Prompt

Un prompt efectivo para un controlador debe incluir:

1. **Verbo HTTP específico:** GET, POST, PUT, PATCH, DELETE por endpoint
2. **Ruta completa:** URL path incluyendo versión de API
3. **Propósito del endpoint:** Qué operación realiza
4. **Autenticación/Autorización:** Roles permitidos para cada endpoint
5. **Parámetros de query/body:** Qué datos recibe
6. **Códigos de respuesta:** Qué retorna (200, 201, 400, 401, 403, 404)
7. **Paginación/Filtros:** Para endpoints GET con colecciones

### Endpoints Requeridos

| Verbo | Ruta | Propósito | Auth |
|-------|------|-----------|------|
| GET | /api/v1/joboffers | Lista ofertas (paginado + filtros) | Anonymous |
| GET | /api/v1/joboffers/{id} | Detalle oferta por ID | Anonymous |
| POST | /api/v1/joboffers | Crear nueva oferta | Company/Admin |
| PUT | /api/v1/joboffers/{id} | Actualizar oferta | Owner/Admin |
| PATCH | /api/v1/joboffers/{id}/status | Cambiar estado | Owner/Admin |
| DELETE | /api/v1/joboffers/{id} | Soft delete | Owner/Admin |

### Parámetros de Query para GET /
```
- page: int (default 1)
- pageSize: int (default 10, max 100)
- q: string (búsqueda en título y descripción)
- location: string
- contractType: ContractType enum
- minSalary: decimal
- maxSalary: decimal
```

### Enumeración JobOfferStatus
```csharp
public enum JobOfferStatus
{
    DRAFT = 0,      // Oferta en preparación
    PUBLISHED = 1,  // Visible y recibiendo postulaciones
    PAUSED = 2,     // Temporalmente oculta
    CLOSED = 3      // Finalizada
}
```

### Enumeración ContractType
```csharp
public enum ContractType
{
    FULL_TIME = 0,
    PART_TIME = 1,
    TEMPORARY = 2,
    FREELANCE = 3
}
```

### Ejemplo de Prompt Mejorado
```markdown
"Create a JobOffersController for a Job Portal API following REST best practices.

Endpoints:
1. GET /api/v1/joboffers
   - Returns paginated list of PUBLISHED offers
   - Query params: page (default 1), pageSize (default 10, max 100),
     q (search in title/description), location, contractType, minSalary, maxSalary
   - Response: 200 OK with paginated result

2. GET /api/v1/joboffers/{id}
   - Returns full offer details including company data
   - Response: 200 OK or 404 Not Found

3. POST /api/v1/joboffers
   - Creates new job offer in DRAFT status
   - Requires JWT authentication with COMPANY or ADMIN role
   - Request body: CreateJobOfferDto
   - Response: 201 Created with location header

4. PUT /api/v1/joboffers/{id}
   - Updates offer (only if DRAFT or PAUSED)
   - Requires JWT, owner or admin
   - Response: 200 OK or 403 Forbidden or 404 Not Found

5. PATCH /api/v1/joboffers/{id}/status
   - Changes offer status (DRAFT -> PUBLISHED, PUBLISHED -> PAUSED, etc.)
   - Requires JWT, owner or admin
   - Request body: { status: JobOfferStatus }
   - Response: 200 OK

6. DELETE /api/v1/joboffers/{id}
   - Soft delete (sets IsActive = false)
   - Requires JWT, owner or admin
   - Response: 204 No Content

Use [Authorize] attribute with role requirements.
Inject IJobOfferService.
Return proper IActionResult with appropriate status codes."
```

---

## Ejercicio 4: Validación con FluentValidation

### Prompt Base (a mejorar)
```markdown
"Add validation for user registration using FluentValidation"
```

### Criterios del Buen Prompt

Un prompt efectivo para validación debe incluir:

1. **Regla por campo:** Cada campo con su validación específica
2. **Mensajes de error:** Mensajes personalizados en español/inglés
3. **Expresiones regulares:** Para formatos complejos (email, teléfono)
4. **Validaciones personalizadas:** Reglas de negocio específicas
5. **Referencia a DTO:** Qué clase se está validando
6. **Cadena de reglas:** Orden de evaluación de reglas

### Campos a Validar en RegisterDto
```
- Email: Required, valid email format, max 256 chars, unique
- Password: Required, min 8 chars, uppercase, lowercase, number, special char
- Name: Required, max 100 chars, not empty/whitespace
- BirthDate: Required, must be at least 16 years old
- Phone: Optional, valid international format
```

### Regex para Validación
```
Email: ^[\w-\.]+@([\w-]+\.)+[\w-]{2,4}$
Password: ^(?=.*[a-z])(?=.*[A-Z])(?=.*\d)(?=.*[@$!%*?&])[A-Za-z\d@$!%*?&]{8,}$
Phone (básico): ^\+?[1-9]\d{1,14}$
```

### Regla de Mayoría de Edad
```csharp
RuleFor(x => x.BirthDate)
    .Must(birthDate => birthDate <= DateTime.UtcNow.AddYears(-16))
    .WithMessage("User must be at least 16 years old");
```

### Regla de Complejidad de Contraseña
```csharp
RuleFor(x => x.Password)
    .MinimumLength(8)
    .WithMessage("Password must be at least 8 characters")
    .Matches("[A-Z]")
    .WithMessage("Password must contain at least one uppercase letter")
    .Matches("[a-z]")
    .WithMessage("Password must contain at least one lowercase letter")
    .Matches("[0-9]")
    .WithMessage("Password must contain at least one number")
    .Matches("[^a-zA-Z0-9]")
    .WithMessage("Password must contain at least one special character");
```

### Ejemplo de Prompt Mejorado
```markdown
"Create a FluentValidation validator for RegisterDto in a Job Portal API.

Validation Rules:
1. Email:
   - Required
   - Valid email format (use regex: ^[\w-\.]+@([\w-]+\.)+[\w-]{2,4}$)
   - Maximum 256 characters
   - Custom message: 'The email format is invalid'

2. Password:
   - Required
   - Minimum 8 characters
   - At least one uppercase letter (A-Z)
   - At least one lowercase letter (a-z)
   - At least one number (0-9)
   - At least one special character (@$!%*?&)
   - Custom messages for each rule

3. Name:
   - Required
   - Maximum 100 characters
   - Not empty or whitespace only
   - Custom message: 'Full name is required'

4. BirthDate:
   - Required
   - Must be at least 16 years old from today
   - Custom message: 'You must be at least 16 years old to register'

5. Phone:
   - Optional
   - If provided, must be valid international format
   - Custom message: 'Invalid phone number format'

Use spanish error messages.
Inherit from AbstractValidator<RegisterDto>.
Return only the C# code for the validator class."
```

---

## Ejercicio 5: Patrón Repository

### Prompt Base (a mejorar)
```markdown
"Create a repository interface for User entity"
```

### Criterios del Buen Prompt

Un prompt efectivo para un repositorio debe incluir:

1. **Métodos de CRUD:** Create, Read, Update, Delete
2. **Consultas específicas:** Métodos con filtros particulares
3. **Tipos de retorno:** Task, Task<T>, IEnumerable<T>, IQueryable<T>
4. **Operaciones asíncronas:** Todo debe ser async
5. **Especificaciones de query:** Incluir includes para navegación
6. **Paginación:** Parámetros y formato de retorno

### Métodos Requeridos para IUserRepository
```
- AddAsync(User user): Task
- GetByIdAsync(Guid id): Task<User>
- GetByEmailAsync(string email): Task<User>
- GetAllAsync(): Task<IEnumerable<User>>
- GetActiveUsersAsync(): Task<IEnumerable<User>>
- UpdateAsync(User user): Task
- DeleteAsync(Guid id): Task (soft delete)
- ExistsAsync(Guid id): Task<bool>
- ExistsByEmailAsync(string email): Task<bool>
- GetByRoleAsync(UserRole role): Task<IEnumerable<User>>
```

### Especificaciones de Query
```
- GetByIdAsync: Include related entities (JobOffers, Applications)
- GetAllAsync: Filter by IsActive = true by default
- GetByEmailAsync: No tracking recommended (AsNoTracking)
- Pagination support: Take/Skip parameters where applicable
```

### Ejemplo de Prompt Mejorado
```markdown
"Create IUserRepository interface for a Job Portal API following Repository Pattern.

Methods:
1. Task AddAsync(User user)
   - Adds new user to database

2. Task<User?> GetByIdAsync(Guid id, bool includeRelations = false)
   - Finds user by Id
   - If includeRelations=true, include JobOffers and Applications
   - Returns null if not found

3. Task<User?> GetByEmailAsync(string email, bool trackChanges = false)
   - Finds user by email (unique)
   - Use AsNoTracking if trackChanges=false
   - Returns null if not found

4. Task<IEnumerable<User>> GetAllAsync(bool activeOnly = true, int page = 1, int pageSize = 10)
   - Returns paginated list of users
   - If activeOnly=true, filter by IsActive=true
   - Apply pagination (skip = (page-1) * pageSize, take = pageSize)

5. Task<IEnumerable<User>> GetByRoleAsync(UserRole role, bool activeOnly = true)
   - Returns all users with specified role

6. Task UpdateAsync(User user)
   - Updates existing user in database

7. Task DeleteAsync(Guid id)
   - Soft delete: sets IsActive = false
   - Does not physically remove record

8. Task<bool> ExistsAsync(Guid id)
   - Returns true if user exists

9. Task<bool> ExistsByEmailAsync(string email)
   - Returns true if email is already registered

All methods must be async with Task/Task<T> return types.
Use CancellationToken parameter where appropriate.
Return only the C# interface definition."
```

---

## Plantilla de Entrega para el Alumno

### Prompt Generado

```markdown
[Pegar aquí el prompt que hayas escrito]
```

---

### Análisis del Prompt

| Aspecto | Descripción | Puntuación (1-5) |
|---------|-------------|------------------|
| **Contexto** | ¿Se menciona el dominio/propósito? | ____ |
| **Rol** | ¿Se especifica el rol del asistente? | ____ |
| **Especificidad** | ¿Son los requisitos detallados? | ____ |
| **Formato** | ¿Se indica formato de salida? | ____ |
| **Restricciones** | ¿Se incluyen límites/reglas? | ____ |
| **Excepciones** | ¿Se mencionan errores a manejar? | ____ |

---

### Código Generado por Copilot

```csharp
[Pegar aquí el código que Copilot generó]
```

---

### Evaluación del Resultado

| Criterio | Cumple | Observaciones |
|----------|--------|---------------|
| Compila sin errores | ☐ Sí ☐ No | |
| Sigue convenciones C# | ☐ Sí ☐ No | |
| Usa async/await | ☐ Sí ☐ No | |
| Incluye documentación | ☐ Sí ☐ No | |
| Maneja casos edge | ☐ Sí ☐ No | |

---

### Prompt Mejorado (versión 2.0)

```markdown
[Aquí escribe la versión mejorada del prompt tras la evaluación]
```

---

## Recursos Adicionales

- **Documentación FluentValidation:** https://docs.fluentvalidation.net/
- **Guía JWT en ASP.NET Core:** https://jwt.io/introduction
- **Patrón Repository:** https://docs.microsoft.com/en-us/aspnet/core/data/ef-mvc/read-related-data
- **Convenciones C#:** https://docs.microsoft.com/en-us/dotnet/csharp/fundamentals/coding-style/coding-conventions

---

## Criterios de Evaluación

| Criterio | Peso | Descripción |
|----------|------|-------------|
| Claridad del prompt | 25% | Qué tan bien estructurado y específico |
| Inclusión de contexto | 20% | Dominio, arquitectura, restricciones |
| Precisión técnica | 25% | Uso correcto de términos y patrones |
| Cobertura de requisitos | 20% | Qué tan completos son los requisitos |
| Calidad del código generado | 10% | Evaluación del output de Copilot |

---

**Tiempo estimado:** 45 minutos (9 minutos por ejercicio)  
**Entregable:** Documento con los 5 prompts mejorados y su análisis
