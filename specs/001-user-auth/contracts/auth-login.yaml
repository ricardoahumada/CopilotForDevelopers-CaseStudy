openapi: 3.0.3
info:
  title: Portal Empleo API - User Login
  version: 1.0.0
  description: Endpoint for user authentication with JWT tokens

servers:
  - url: http://localhost:5000
    description: Development server
  - url: https://api.portalempleo.com
    description: Production server

paths:
  /api/v1/auth/login:
    post:
      tags:
        - Authentication
      summary: Authenticate user and obtain tokens
      description: |
        Validates credentials and returns JWT access token + refresh token.
        Protects against brute force: lockout for 15 minutes after 5 consecutive failed attempts.
        Failed attempts counter resets after successful login or lockout expiration.
      operationId: loginUser
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/LoginDto'
            example:
              email: "juan.perez@example.com"
              password: "Secure123"
      responses:
        '200':
          description: Login successful
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/AuthResultDto'
              example:
                accessToken: "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9..."
                refreshToken: "a1b2c3d4e5f6g7h8i9j0k1l2m3n4o5p6q7r8s9t0"
                expiresAt: "2026-02-04T15:30:00Z"
        '400':
          description: Validation error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ValidationErrorResponse'
              example:
                error: "ValidationError"
                message: "One or more validation errors occurred."
                validationErrors:
                  Email:
                    - "El email es requerido."
        '401':
          description: Invalid credentials
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              example:
                error: "InvalidCredentials"
                message: "Email o contraseña incorrectos."
        '429':
          description: Too many failed attempts (rate limited)
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              example:
                error: "TooManyRequests"
                message: "Cuenta bloqueada. Intenta en 12 minutos."

components:
  schemas:
    LoginDto:
      type: object
      required:
        - email
        - password
      properties:
        email:
          type: string
          format: email
          description: "User email"
          example: "juan.perez@example.com"
        password:
          type: string
          description: "User password"
          example: "Secure123"

    AuthResultDto:
      type: object
      required:
        - accessToken
        - refreshToken
        - expiresAt
      properties:
        accessToken:
          type: string
          description: "JWT access token (valid for 60 minutes)"
          example: "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9..."
        refreshToken:
          type: string
          description: "Refresh token (valid for 7 days)"
          example: "a1b2c3d4e5f6g7h8i9j0k1l2m3n4o5p6q7r8s9t0"
        expiresAt:
          type: string
          format: date-time
          description: "Access token expiration timestamp (UTC)"
          example: "2026-02-04T15:30:00Z"

    ValidationErrorResponse:
      type: object
      required:
        - error
        - message
      properties:
        error:
          type: string
          example: "ValidationError"
        message:
          type: string
          example: "One or more validation errors occurred."
        validationErrors:
          type: object
          additionalProperties:
            type: array
            items:
              type: string

    ErrorResponse:
      type: object
      required:
        - error
        - message
      properties:
        error:
          type: string
          description: "Error code (InvalidCredentials, TooManyRequests)"
          example: "InvalidCredentials"
        message:
          type: string
          description: "Human-readable error message"
          example: "Email o contraseña incorrectos."
