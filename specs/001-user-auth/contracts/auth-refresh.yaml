openapi: 3.0.3
info:
  title: Portal Empleo API - Token Refresh
  version: 1.0.0
  description: Endpoint for refreshing access tokens using refresh tokens

servers:
  - url: http://localhost:5000
    description: Development server
  - url: https://api.portalempleo.com
    description: Production server

paths:
  /api/v1/auth/refresh:
    post:
      tags:
        - Authentication
      summary: Refresh access token
      description: |
        Validates refresh token and issues new access token + new refresh token (token rotation).
        Old refresh token is revoked after successful rotation.
        Fails if refresh token is expired (>7 days), revoked, or invalid.
      operationId: refreshToken
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/RefreshTokenDto'
            example:
              refreshToken: "a1b2c3d4e5f6g7h8i9j0k1l2m3n4o5p6q7r8s9t0"
      responses:
        '200':
          description: Token refreshed successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/AuthResultDto'
              example:
                accessToken: "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9..."
                refreshToken: "b2c3d4e5f6g7h8i9j0k1l2m3n4o5p6q7r8s9t0u1"
                expiresAt: "2026-02-04T16:00:00Z"
        '400':
          description: Validation error (missing token)
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ValidationErrorResponse'
              example:
                error: "ValidationError"
                message: "One or more validation errors occurred."
                validationErrors:
                  RefreshToken:
                    - "El refresh token es requerido."
        '401':
          description: Invalid, expired, or revoked refresh token
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              examples:
                invalidToken:
                  value:
                    error: "InvalidRefreshToken"
                    message: "El refresh token no es válido."
                expiredToken:
                  value:
                    error: "RefreshTokenExpired"
                    message: "El refresh token ha expirado. Inicia sesión nuevamente."
                revokedToken:
                  value:
                    error: "RefreshTokenRevoked"
                    message: "El refresh token ha sido revocado."

components:
  schemas:
    RefreshTokenDto:
      type: object
      required:
        - refreshToken
      properties:
        refreshToken:
          type: string
          description: "Refresh token obtained from /auth/login or previous /auth/refresh"
          example: "a1b2c3d4e5f6g7h8i9j0k1l2m3n4o5p6q7r8s9t0"

    AuthResultDto:
      type: object
      required:
        - accessToken
        - refreshToken
        - expiresAt
      properties:
        accessToken:
          type: string
          description: "New JWT access token (valid for 60 minutes)"
          example: "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9..."
        refreshToken:
          type: string
          description: "New refresh token (valid for 7 days, old token is revoked)"
          example: "b2c3d4e5f6g7h8i9j0k1l2m3n4o5p6q7r8s9t0u1"
        expiresAt:
          type: string
          format: date-time
          description: "New access token expiration timestamp (UTC)"
          example: "2026-02-04T16:00:00Z"

    ValidationErrorResponse:
      type: object
      required:
        - error
        - message
      properties:
        error:
          type: string
          example: "ValidationError"
        message:
          type: string
          example: "One or more validation errors occurred."
        validationErrors:
          type: object
          additionalProperties:
            type: array
            items:
              type: string

    ErrorResponse:
      type: object
      required:
        - error
        - message
      properties:
        error:
          type: string
          description: "Error code (InvalidRefreshToken, RefreshTokenExpired, RefreshTokenRevoked)"
          example: "InvalidRefreshToken"
        message:
          type: string
          description: "Human-readable error message"
          example: "El refresh token no es válido."
